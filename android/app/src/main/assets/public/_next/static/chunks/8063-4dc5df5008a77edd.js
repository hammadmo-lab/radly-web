"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5656,8063,8927],{13077:(e,t,a)=>{a.d(t,{getSupabaseClient:()=>l});var i=a(11993),n=a(16010),r=a(32587),s=a(4077);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}async initialize(){if(!this.initialized)return this.initializationPromise||(this.initializationPromise=this._doInitialize()),this.initializationPromise}async _doInitialize(){try{if(!r.Capacitor.isNativePlatform()){this.initialized=!0;return}let{keys:e}=await s.Preferences.keys();for(let t of e.filter(e=>e.startsWith(this.STORAGE_PREFIX)))try{let{value:e}=await s.Preferences.get({key:t});if(e){let a=t.substring(this.STORAGE_PREFIX.length);this.cache.set(a,e)}}catch(e){}this.initialized=!0}catch(e){this.initialized=!0}}getItem(e){return this.initialized&&this.cache.get(e)||null}setItem(e,t){this.initialized&&(this.cache.set(e,t),this._persistToStorage(e,t).catch(e=>{}))}removeItem(e){this.initialized&&(this.cache.delete(e),this._removeFromStorage(e).catch(e=>{}))}async _persistToStorage(e,t){if(!r.Capacitor.isNativePlatform())return;let a=this.STORAGE_PREFIX+e;try{await s.Preferences.set({key:a,value:t})}catch(e){throw e}}async _removeFromStorage(e){if(!r.Capacitor.isNativePlatform())return;let t=this.STORAGE_PREFIX+e;try{await s.Preferences.remove({key:t})}catch(e){throw e}}async clear(){if(this.cache.clear(),r.Capacitor.isNativePlatform())try{let{keys:e}=await s.Preferences.keys();for(let t of e.filter(e=>e.startsWith(this.STORAGE_PREFIX)))await s.Preferences.remove({key:t})}catch(e){}}getDebugInfo(){return{initialized:this.initialized,cacheSize:this.cache.size,cachedKeys:Array.from(this.cache.keys()),platform:r.Capacitor.isNativePlatform()?"capacitor":"web",prefix:this.STORAGE_PREFIX}}constructor(){this.cache=new Map,this.initialized=!1,this.initializationPromise=null,this.STORAGE_PREFIX="sb-"}}async function l(){if(a.g.__supabase_client&&a.g.__supabase_client_initialized)return a.g.__supabase_client;if(a.g.__supabase_client_initialized){let e=0;for(;!a.g.__supabase_client&&e<50;)await new Promise(e=>setTimeout(e,100)),e++;if(a.g.__supabase_client)return a.g.__supabase_client;throw Error("Supabase client initialization timeout")}a.g.__supabase_client_initialized=!0;try{let e,t,r=(()=>{var e;let t=window.Capacitor;return!!(null==t||null==(e=t.isNativePlatform)?void 0:e.call(t))})();if(r){let e=o.getInstance();await e.initialize(),t=function(){let e=o.getInstance();return e.initialize().catch(e=>{}),{getItem:t=>e.getItem(t),setItem:(t,a)=>e.setItem(t,a),removeItem:t=>e.removeItem(t)}}()}return e=r?(0,i.UU)("https://bsldtgivgtyzacwyvcfh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzbGR0Z2l2Z3R5emFjd3l2Y2ZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MzQ1NzMsImV4cCI6MjA3NTUxMDU3M30.vjHPo6WEASxYBOAGYmZ93o5n9RhZvANSlLhaT-wagTs",{auth:{storage:t,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1,debug:!0}}):(0,n.createBrowserClient)("https://bsldtgivgtyzacwyvcfh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzbGR0Z2l2Z3R5emFjd3l2Y2ZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MzQ1NzMsImV4cCI6MjA3NTUxMDU3M30.vjHPo6WEASxYBOAGYmZ93o5n9RhZvANSlLhaT-wagTs",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1,flowType:"pkce",debug:!1}}),a.g.__supabase_client=e,e.__isSingleton=!0,e.__createdAt=new Date().toISOString(),e.__platform=r?"capacitor":"web",e}catch(e){throw a.g.__supabase_client_initialized=!1,e}}void 0===a.g&&(globalThis.global=globalThis)},18927:(e,t,a)=>{a.d(t,{O:()=>h,A:()=>d});var i=a(95155),n=a(12115),r=a(32587),s=a(16010),o=a(90260);function l(){try{let e=(0,s.createBrowserClient)("https://bsldtgivgtyzacwyvcfh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzbGR0Z2l2Z3R5emFjd3l2Y2ZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MzQ1NzMsImV4cCI6MjA3NTUxMDU3M30.vjHPo6WEASxYBOAGYmZ93o5n9RhZvANSlLhaT-wagTs",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1,flowType:"pkce",debug:!1}});if((0,o.Wj)()){let t=(0,o.Ld)();return{...e,auth:{...e.auth,getSession:async()=>({data:{session:t},error:null}),getUser:async()=>({data:{user:(null==t?void 0:t.user)||null},error:null}),signOut:async()=>({error:null}),signInWithOAuth:async()=>({error:Error("Test mode: OAuth not available")}),exchangeCodeForSession:async()=>({error:Error("Test mode: Code exchange not available")}),onAuthStateChange:e=>(e("SIGNED_IN",t),{data:{subscription:{unsubscribe:()=>{}}}})}}}return e}catch(e){return{auth:{getSession:async()=>({data:{session:null},error:null}),getUser:async()=>({data:{user:null},error:null}),signOut:async()=>({error:null}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}}),signInWithOAuth:async()=>({error:Error("Mock client: OAuth not available")}),exchangeCodeForSession:async()=>({error:Error("Mock client: Code exchange not available")})}}}}var c=a(13077);let u=(0,n.createContext)(void 0);function h(e){let{children:t}=e,[s,o]=(0,n.useState)(null),[h,d]=(0,n.useState)(null),[f,p]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e;return(async()=>{try{var t;let a=r.Capacitor.isNativePlatform()?await (0,c.getSupabaseClient)():l(),{data:{session:i}}=await a.auth.getSession();d(i),o(null!=(t=null==i?void 0:i.user)?t:null),p(!1);let{data:{subscription:n}}=a.auth.onAuthStateChange((e,t)=>{var a;d(t),o(null!=(a=null==t?void 0:t.user)?a:null),p(!1)});e=()=>n.unsubscribe()}catch(e){d(null),o(null),p(!1)}})(),()=>{try{null==e||e()}catch(e){}}},[]);let I=async()=>{try{let e=r.Capacitor.isNativePlatform()?await (0,c.getSupabaseClient)():l();await e.auth.signOut();let{clearTokenCache:t}=await a.e(5656).then(a.bind(a,25656));t()}catch(e){}};return(0,i.jsx)(u.Provider,{value:{user:s,session:h,loading:f,signOut:I},children:t})}function d(){let e=(0,n.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},25656:(e,t,a)=>{a.d(t,{clearTokenCache:()=>u,lx:()=>d,yd:()=>p,zA:()=>f});var i=a(96648),n=a(32587);let r="https://edge.radly.app",s="0f0a24adba9edfede4bc7413f85967224db6d1501c16f5213e901048cf4eb445",o=null,l=0;async function c(){try{let e=Date.now();if(o&&l>e+3e5)return o;let t=null,r=0;if(n.Capacitor.isNativePlatform()){let{getSupabaseClient:e}=await a.e(3077).then(a.bind(a,13077)),i=await e(),{data:{session:n}}=await i.auth.getSession();t=(null==n?void 0:n.access_token)||null,r=(null==n?void 0:n.expires_at)?1e3*n.expires_at:0}else{let e=(0,i.createBrowserSupabase)(),{data:{session:a}}=await e.auth.getSession();t=(null==a?void 0:a.access_token)||null,r=(null==a?void 0:a.expires_at)?1e3*a.expires_at:0}return o=t,l=r,o}catch(e){return null}}function u(){o=null,l=0}async function h(e){if(!e.ok){let t=await e.text().catch(()=>""),a=Error("".concat(e.status," ").concat(e.statusText));throw a.status=e.status,a.body=t,a}if(204!==e.status)return await e.json()}async function d(e){let t=await c(),a={"x-client-key":s,"X-Request-Id":crypto.randomUUID()};return t&&(a.authorization="Bearer ".concat(t)),h(await fetch("".concat(r).concat(e),{method:"GET",headers:a,credentials:"include",cache:"no-store"}))}async function f(e,t){let a=await c(),i={"content-type":"application/json","x-client-key":s,"X-Request-Id":crypto.randomUUID()};return a&&(i.authorization="Bearer ".concat(a)),h(await fetch("".concat(r).concat(e),{method:"POST",headers:i,body:JSON.stringify(t),credentials:"include"}))}async function p(e,t){let a=await c(),i={"content-type":"application/json","x-client-key":s,"X-Request-Id":crypto.randomUUID()};return a&&(i.authorization="Bearer ".concat(a)),h(await fetch("".concat(r).concat(e),{method:"PUT",headers:i,body:JSON.stringify(t),credentials:"include"}))}},31969:(e,t,a)=>{a.d(t,{JO:()=>o,Rs:()=>s});var i=a(22454),n=a(25656),r=a(85578);function s(){let{isAuthed:e,mounted:t}=(0,r.Q)();return(0,i.I)({queryKey:["subscription-usage"],queryFn:()=>(0,n.lx)("/v1/subscription/usage"),refetchInterval:6e4,enabled:t&&e,retry:(e,t)=>{if(t&&"object"==typeof t&&"status"in t){let e=t.status;if(401===e||403===e||404===e)return!1}return e<3},staleTime:3e4})}function o(){let{data:e}=s();return(null==e?void 0:e.subscription.tier)||"free"}},85578:(e,t,a)=>{a.d(t,{Q:()=>o});var i=a(12115),n=a(96648),r=a(90260),s=a(32587);function o(){let[e,t]=(0,i.useState)(!1),[o,l]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if((0,r.Wj)()){l((0,r.Ld)()),t(!0);return}let e=()=>{};return async function(){if(s.Capacitor.isNativePlatform()){let{getSupabaseClient:t}=await a.e(3077).then(a.bind(a,13077)),i=await t(),{data:n}=await i.auth.getSession();l(n.session);let{data:r}=i.auth.onAuthStateChange((e,t)=>l(t));e=()=>{var e,t;return null==r||null==(t=r.subscription)||null==(e=t.unsubscribe)?void 0:e.call(t)}}else{let t=(0,n.createBrowserSupabase)(),{data:a}=await t.auth.getSession();l(a.session);let{data:i}=t.auth.onAuthStateChange((e,t)=>l(t));e=()=>{var e,t;return null==i||null==(t=i.subscription)||null==(e=t.unsubscribe)?void 0:e.call(t)}}t(!0)}(),()=>e()},[]),{session:o,isAuthed:!!o,mounted:e}}},90260:(e,t,a)=>{a.d(t,{Ld:()=>r,Wj:()=>n});var i=a(95704);function n(){return"true"===i.env.NEXT_PUBLIC_TEST_MODE||"true"===i.env.NEXT_PUBLIC_BYPASS_AUTH||"true"===new URLSearchParams(window.location.search).get("test")}function r(){if(!n())return null;let e=n()?{id:"test-user-id-12345",email:"test@radly.test",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z",aud:"authenticated",role:"authenticated",app_metadata:{},user_metadata:{full_name:"Test User"},identities:[],factors:[],is_anonymous:!1,phone:"",email_confirmed_at:"2024-01-01T00:00:00Z",phone_confirmed_at:void 0,confirmed_at:"2024-01-01T00:00:00Z",last_sign_in_at:"2024-01-01T00:00:00Z",is_sso_user:!1,provider:"email",providers:["email"]}:null;return e?{access_token:"test-access-token",refresh_token:"test-refresh-token",expires_in:3600,expires_at:Math.floor(Date.now()/1e3)+3600,token_type:"bearer",user:e}:null}},96648:(e,t,a)=>{a.d(t,{createBrowserSupabase:()=>n});var i=a(16010);function n(){return(0,i.createBrowserClient)("https://bsldtgivgtyzacwyvcfh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzbGR0Z2l2Z3R5emFjd3l2Y2ZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MzQ1NzMsImV4cCI6MjA3NTUxMDU3M30.vjHPo6WEASxYBOAGYmZ93o5n9RhZvANSlLhaT-wagTs",{auth:{flowType:"pkce",detectSessionInUrl:!0,persistSession:!0}})}}}]);